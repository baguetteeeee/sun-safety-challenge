<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mela vs UV</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f0f8ff;
    }
    #game {
      margin-top: 20px;
    }
    .healthbar {
      width: 200px;
      height: 20px;
      background: #ddd;
      border: 2px solid #000;
      margin: 10px auto;
      position: relative;
    }
    .health {
      height: 100%;
      background: green;
      width: 100%;
      transition: width 0.5s linear; /* smooth shrink */
    }
    #certificate {
      display: none;
      margin-top: 20px;
    }
    canvas {
      max-width: 100%;
    }
    button {
      margin: 8px;
      padding: 8px 16px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>Mela vs The UV Villain ‚òÄÔ∏è</h1>

  <div id="game">
    <h3>Which protection works against UV?</h3>
    <div id="options"></div>

    <div>
      <h4>Mela‚Äôs Health</h4>
      <div class="healthbar"><div id="melaHealth" class="health"></div></div>
      <h4>UV Villain‚Äôs Health</h4>
      <div class="healthbar"><div id="uvHealth" class="health"></div></div>
    </div>
  </div>

  <div id="certificate">
    <h2>üéâ Congratulations! üéâ</h2>
    <p>You defeated the UV Villain! Enter your name for your certificate:</p>
    <input type="text" id="playerName" placeholder="Your Name">
    <button onclick="generateCertificate()">Get Certificate</button>
    <br><br>
    <canvas id="certCanvas" width="800" height="600"></canvas>
  </div>

  <script>
    let melaHealth = 5;
    let uvHealth = 5;

    const melaBar = document.getElementById("melaHealth");
    const uvBar = document.getElementById("uvHealth");
    const optionsDiv = document.getElementById("options");

    const correctOptions = ["Wearing a hat üëí", "Seeking shade üå≥", "Wearing sunglasses üï∂Ô∏è", "Applying sunscreen üß¥"];
    const wrongOptions = ["Eating ice cream üç¶", "Dancing in the sun üíÉ", "Listening to music üéµ", "Drinking soda ü•§"];

    function updateHealthBars() {
      melaBar.style.width = (melaHealth / 5 * 100) + "%";
      uvBar.style.width = (uvHealth / 5 * 100) + "%";
      if (melaHealth <= 0) endGame(false);
      if (uvHealth <= 0) endGame(true);
    }

    function pickOptions() {
      optionsDiv.innerHTML = "";
      let allOptions = [...correctOptions, ...wrongOptions];
      allOptions.sort(() => Math.random() - 0.5);
      allOptions.slice(0, 4).forEach(option => {
        let btn = document.createElement("button");
        btn.textContent = option;
        btn.onclick = () => handleAnswer(option);
        optionsDiv.appendChild(btn);
      });
    }

    function handleAnswer(option) {
      if (correctOptions.includes(option)) {
        uvHealth--;
      } else {
        melaHealth--;
      }
      updateHealthBars();
      pickOptions();
    }

    function endGame(playerWon) {
      document.getElementById("game").style.display = "none";
      document.getElementById("certificate").style.display = "block";
      if (!playerWon) {
        document.querySelector("#certificate h2").textContent = "üíÄ Oh no! The UV Villain wins...";
        document.querySelector("#certificate p").style.display = "none";
        document.querySelector("#certificate input").style.display = "none";
        document.querySelector("#certificate button").style.display = "none";
      }
    }

    // draw curved text for certificate
    function drawCurvedText(ctx, text, centerX, centerY, radius) {
      ctx.save();
      ctx.translate(centerX, centerY);
      ctx.textAlign = "center";
      ctx.font = "40px Arial";
      ctx.fillStyle = "black";

      let angle = Math.PI / (text.length + 2);
      let startAngle = -angle * (text.length - 1) / 2;

      for (let i = 0; i < text.length; i++) {
        let char = text[i];
        let theta = startAngle + i * angle;

        ctx.save();
        ctx.rotate(theta);
        ctx.translate(0, -radius);
        ctx.rotate(-theta); // keep upright
        ctx.fillText(char, 0, 0);
        ctx.restore();
      }

      ctx.restore();
    }

    function generateCertificate() {
      const canvas = document.getElementById("certCanvas");
      const ctx = canvas.getContext("2d");
      const playerName = document.getElementById("playerName").value || "Champion";

      let img = new Image();
      img.src = "https://iili.io/KJag612.md.png";
      img.onload = function() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

        // place curved text about 1/3 from bottom
        let y = canvas.height * 0.66;
        let x = canvas.width / 2;
        drawCurvedText(ctx, playerName, x, y, 150);
      }
    }

    // init
    updateHealthBars();
    pickOptions();
  </script>
</body>
</html>
