<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mela vs UV Villain</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #e0f7fa;
  }
  #gameArea {
    position: relative;
    width: 600px;
    height: 400px;
    margin: 20px auto;
    border: 2px solid #333;
    background: white;
    overflow: hidden;
  }
  #mela, #villain {
    position: absolute;
    width: 80px;
    height: 80px;
  }
  #mela {
    bottom: 10px;
    left: 260px;
  }
  #villain {
    top: 10px;
    left: 260px;
  }
  .ray {
    position: absolute;
    width: 10px;
    height: 40px;
    background: orange;
    top: 100px;
    left: 295px;
    transition: top 0.03s linear;
  }
  #buttons {
    margin-top: 20px;
  }
  button {
    padding: 10px 15px;
    margin: 0 10px;
    font-size: 16px;
    cursor: pointer;
  }
  #message {
    margin-top: 15px;
    font-weight: bold;
  }
  .health-container {
    width: 300px;
    height: 20px;
    border: 2px solid #333;
    margin: 10px auto;
    background: #eee;
  }
  .health-bar {
    height: 100%;
    width: 100%;
    background: green;
    transition: width 0.3s;
  }
  #certificateCanvas {
    margin-top: 20px;
    display: none;
    border: 1px solid #333;
  }
</style>
</head>
<body>

<h1>Mela vs UV Villain</h1>

<div class="health-container">UV Villain</div>
<div id="villainHealthBar" class="health-bar"></div>

<div id="gameArea">
  <img id="mela" src="https://heyclipart.com/cdn/shop/files/2-mole-in-hole-vector-cartoon-illustration-42.jpg" alt="Mela">
  <img id="villain" src="https://st2.depositphotos.com/3250055/8394/v/950/depositphotos_83944362-stock-illustration-evil-cartoon-sun.jpg" alt="UV Villain">
</div>

<div class="health-container">Mela</div>
<div id="melaHealthBar" class="health-bar"></div>

<div id="buttons"></div>

<div id="message"></div>

<canvas id="certificateCanvas" width="600" height="400"></canvas>

<script>
let villainHealth = 5;
let melaHealth = 5;
let rayInterval;
let activeRay = null;

// Correct and wrong options
const correctOptions = ["Sunscreen", "Hat", "Shade", "Sunglasses"];
const wrongOptionsPool = [
  "Wear short sleeves", "Jump in a puddle", "Eat ice cream", "Dance in the sun", "Cover eyes with hands", "Sit on the grass", "Drink water"
];

// Smooth ray creation
function startRay() {
  const gameArea = document.getElementById('gameArea');
  const ray = document.createElement('div');
  ray.classList.add('ray');
  gameArea.appendChild(ray);
  activeRay = ray;
  
  let topPos = 100;
  const fall = setInterval(() => {
    topPos += 3; // smooth step
    ray.style.top = topPos + 'px';
    if (topPos >= 350) {
      clearInterval(fall);
      if (ray.parentNode) ray.parentNode.removeChild(ray);
      activeRay = null;
      melaHealth--;
      updateHealthBars();
      showMessage('UV hit Mela! ðŸ˜¢', 'red');
      checkGameOver();
    }
  }, 20);
}

// Randomized buttons
function setButtons() {
  const buttonsDiv = document.getElementById('buttons');
  buttonsDiv.innerHTML = "";

  const correct = correctOptions[Math.floor(Math.random() * correctOptions.length)];
  let options = [correct];
  while (options.length < 3) {
    let rand = wrongOptionsPool[Math.floor(Math.random() * wrongOptionsPool.length)];
    if (!options.includes(rand)) options.push(rand);
  }

  options.sort(() => Math.random() - 0.5);

  options.forEach(opt => {
    const btn = document.createElement('button');
    btn.textContent = opt;
    btn.onclick = () => protect(opt);
    buttonsDiv.appendChild(btn);
  });
}

// Protect function with smooth bounce
function protect(option) {
  if (!activeRay) return; 
  const ray = activeRay;
  activeRay = null;
  if (correctOptions.includes(option)) {
    let pos = parseInt(ray.style.top);
    const bounce = setInterval(() => {
      pos -= 5;
      ray.style.top = pos + 'px';
      ray.style.background = 'red';
      if (pos <= 10) {
        clearInterval(bounce);
        if (ray.parentNode) ray.parentNode.removeChild(ray);
        villainHealth--;
        updateHealthBars();
        checkGameOver();
      }
    }, 20);
    showMessage('Blocked the UV ray! ðŸ˜Ž', 'green');
  } else {
    if (ray.parentNode) ray.parentNode.removeChild(ray);
    melaHealth--;
    updateHealthBars();
    showMessage('Wrong choice! UV got through! ðŸ˜¢', 'red');
    checkGameOver();
  }
}

// Update health bars
function updateHealthBars() {
  document.getElementById('villainHealthBar').style.width = (villainHealth/5*100) + "%";
  document.getElementById('melaHealthBar').style.width = (melaHealth/5*100) + "%";
}

// Check game over
function checkGameOver() {
  if (villainHealth <= 0) {
    clearInterval(rayInterval);
    showMessage('Mela defeated the UV Villain! ðŸŽ‰', 'blue');
    setButtons([]);
    generateCertificate();
  } else if (melaHealth <= 0) {
    clearInterval(rayInterval);
    showMessage('Mela got defeated! ðŸ˜¢', 'red');
    setButtons([]);
  } else {
    setButtons();
  }
}

// Show messages
function showMessage(text, color) {
  const msg = document.getElementById('message');
  msg.textContent = text;
  msg.style.color = color;
}

// Certificate generation with curved text
function generateCertificate() {
  const name = prompt("Congratulations! Enter your name for the certificate:");
  if (!name) return;

  const canvas = document.getElementById('certificateCanvas');
  canvas.style.display = 'block';
  const ctx = canvas.getContext('2d');
  const img = new Image();
  img.src = 'https://iili.io/KJag612.md.png';
  img.onload = function() {
    // Center image and keep aspect
    const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
    const x = (canvas.width - img.width * scale)/2;
    const y = (canvas.height - img.height * scale)/2 + 20;
    ctx.drawImage(img, x, y, img.width*scale, img.height*scale);

    // Draw curved text
    ctx.font = "30px Arial";
    ctx.fillStyle = "black";
    ctx.textAlign = "center";
    const radius = 100;
    const text = name;
    const centerX = canvas.width/2;
    const centerY = y + 160; // adjust vertical position
    const startAngle = -Math.PI/2 - (text.length/2 * 0.12); // adjust curve

    for (let i = 0; i < text.length; i++) {
      const char = text[i];
      const angle = startAngle + i*0.12;
      ctx.save();
      ctx.translate(centerX + radius * Math.cos(angle), centerY + radius * Math.sin(angle));
      ctx.rotate(angle + Math.PI/2);
      ctx.fillText(char, 0, 0);
      ctx.restore();
    }
  }
}

// Initialize
setButtons();
rayInterval = setInterval(startRay, 3000);

</script>

</body>
</html>
